<nav class="navbar navbar-expand-lg bg-body-tertiary">
    <div class="container-fluid">
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                <li class="nav-item">
                    <a class="nav-link active" aria-current="page" href="/">Home</a>
                </li>
                {% if current_user.is_authenticated and current_user.is_admin %}
                <li class="nav-item"><a class="nav-link" href="/add-brands">Add brands</a></li>
                <li class="nav-item"><a class="nav-link" href="/add-product">Add products</a></li>
                {% endif %}

                {% if current_user.is_authenticated %}
                <li class="nav-item"><a class="nav-link" href="/add-auctions">Add auctions</a></li>
                <li class="nav-item"><a class="nav-link" href="/auctions">Auctions</a></li>
                <li class="nav-item"><a class="nav-link" href="/me">Profile</a></li>
                <li class="nav-item"><a class="nav-link" href="/payment-methods">Payment Methods</a></li>
                {% endif %}
            </ul>

            <form class="d-flex gap-2 me-2 position-relative" role="search">
                <input id="search-input" class="form-control flex-grow-1" type="search" placeholder="Search" aria-label="Search" style="min-width: 300px;">
                <div id="suggestions" class="dropdown-menu" style="position: absolute; top: 100%; z-index: 1000;"></div>
                <button class="btn btn-outline-success" type="submit">Search</button>
            </form>

            <div class="d-flex gap-2">
                {% if current_user.is_authenticated %}
                <a class="btn btn-outline-dark" href="/basket">
                    ðŸ§º Basket <span class="badge bg-danger">{{ basket_count }}</span>
                </a>
                <a class="btn btn-outline-secondary" href="/sign-out">Log Out</a>
                {% else %}
                <a class="btn btn-outline-success" href="/register">Register</a>
                <a class="btn btn-outline-success" href="/sign-in">Login</a>
                {% endif %}
            </div>
        </div>
    </div>
</nav>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const input = document.getElementById("search-input");
        const suggestionsBox = document.getElementById("suggestions");

        input.addEventListener("input", () => {
            const query = input.value.trim();
            if (!query) {
                suggestionsBox.style.display = "none";
                return;
            }

            fetch(`/api/search_suggestions?q=${encodeURIComponent(query)}`)
                .then(res => res.json())
                .then(data => {
                    suggestionsBox.innerHTML = "";
                    if (data.length === 0) {
                        suggestionsBox.style.display = "none";
                        return;
                    }

                    data.forEach(product => {
                        const item = document.createElement("a");
                        item.classList.add("dropdown-item", "d-flex", "align-items-center", "justify-content-between", "gap-2");
                        item.href = `/brands/${product.brand_id}/products/${product.product_id}`;

                        // Left side: image + text
                        const left = document.createElement("div");
                        left.classList.add("d-flex", "align-items-center", "gap-2");

                        const img = document.createElement("img");
                        img.src = product.image;
                        img.alt = product.name;
                        img.style.width = "30px";
                        img.style.height = "30px";
                        img.style.objectFit = "cover";
                        img.style.borderRadius = "4px";

                        const text = document.createElement("span");
                        text.textContent = product.name;

                        left.appendChild(img);
                        left.appendChild(text);

                        // Right side: price
                        const price = document.createElement("span");
                        price.style.color = "orange";
                        price.textContent = product.price;

                        item.appendChild(left);
                        item.appendChild(price);
                        suggestionsBox.appendChild(item);
                    });

                    suggestionsBox.style.display = "block";
                });
        });

        document.addEventListener("click", (e) => {
            if (!e.target.closest("form[role='search']")) {
                suggestionsBox.style.display = "none";
            }
        });

        document.querySelector("form[role='search']").addEventListener("submit", function (e) {
            e.preventDefault();
            const query = input.value.trim();
            if (query) {
                window.location.href = `/search?q=${encodeURIComponent(query)}`;
            }
        });

    });
</script>



<style>
    #suggestions {
        max-height: 300px;
        overflow-y: auto;
        width: 100%;
    }
</style>


